(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{108:function(e,t){},109:function(e,t){},110:function(e,t){},111:function(e,t){},133:function(e,t,a){"use strict";a.r(t);var n=a(0),i=a.n(n),o=a(5),r=a.n(o),c=(a(85),a(15)),l=a(18),s=a(13),d=a(21),u=a(19),m=a(20),h=a(16),g=a(158),p=a(159),f=a(22),v=a.n(f),y=a(157),b=a(27),w=a.n(b),E=a(163);function C(){var e=Object(c.a)(["\n  #takenPictureFrame {\n    max-width: 100%;\n  }\n"]);return C=function(){return e},e}var B=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return(a=Object(d.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(i)))).setVideoStreamMetadata=function(e){a.setState({videoWidth:e.nativeEvent.target.videoWidth,videoHeight:e.nativeEvent.target.videoHeight},function(){console.log("Video stream has width: "+a.state.videoWidth+", height: "+a.state.videoHeight)})},a.showCamera=function(){var e=document.getElementById("cameraStreamView");navigator.mediaDevices.getUserMedia({audio:!1,video:{facingMode:"environment",width:1920,height:1080,aspectRatio:1.777777778}}).then(function(t){e.srcObject=t}).catch(function(e){console.log("It seems you don't have a camera")})},a.takePicture=function(){var e=document.getElementById("hiddenCanvas"),t=e.getContext("2d"),n=document.getElementById("cameraStreamView");e.width=a.state.videoWidth,e.height=a.state.videoHeight,t.drawImage(n,0,0,e.width,e.height),a.saveAsPNG(e)},a.saveAsPNG=function(e){var t=e.toDataURL();a.props.finishedTakingPicture(t)},a}return Object(m.a)(t,e),Object(s.a)(t,[{key:"componentDidMount",value:function(){this.showCamera()}},{key:"componentWillUnmount",value:function(){null!=document.getElementById("cameraStreamView").srcObject&&document.getElementById("cameraStreamView").srcObject.getVideoTracks().forEach(function(e){e.stop()})}},{key:"render",value:function(){return i.a.createElement(S,null,i.a.createElement("div",{className:"imageContainer"},i.a.createElement(E.a,{title:"Back to front-page"},i.a.createElement(y.a,{id:"cancelCameraButton",className:"cancelButton",onClick:this.props.cancelCamera,variant:"contained"},i.a.createElement(w.a,null))),i.a.createElement("video",{onLoadedData:this.setVideoStreamMetadata,playsInline:!0,autoPlay:!0,muted:!0,id:"cameraStreamView",className:"imageView"}),i.a.createElement("div",{id:"takePictureButtonContainer",className:"actionButtonContainer"},i.a.createElement(g.a,{onClick:this.takePicture,className:"actionButton",variant:"contained",color:"primary"},"Take picture")),i.a.createElement("canvas",{id:"hiddenCanvas",hidden:!0}),i.a.createElement("img",{id:"takenPictureFrame",alt:""})))}}]),t}(n.Component),S=h.a.div.attrs({id:"StyledCamera"})(C()),k=B,P=a(68),x=a.n(P);a(102);function O(){var e=Object(c.a)(["\n  #cropPictureButtonContainer {\n    z-index: 1;\n    pointer-events: none;\n  }\n\n  #cropPictureButtonContainer button {\n    pointer-events: all;\n  }\n\n  #preview {\n    width: 50px;\n    height: 50px;\n    overflow: hidden;\n  }\n"]);return O=function(){return e},e}var I=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(d.a)(this,Object(u.a)(t).call(this,e)))._cropperReady=function(){a.cropperInstance=a.refs.cropper},a.handleButtonClick=function(){null===a.state.head.dataURL?a.setState({head:a.getBodyPart(),greatestHeight:a.cropperInstance.getData().height}):null===a.state.body.dataURL?a.setState({body:a.getBodyPart(),greatestHeight:a.getNewGreatestHeight(a.cropperInstance.getData().height,a.state.greatestHeight)}):null===a.state.legs.dataURL?a.setState({legs:a.getBodyPart(),greatestHeight:a.getNewGreatestHeight(a.cropperInstance.getData().height,a.state.greatestHeight)}):a.props.finishedCropping({head:a.state.head,body:a.state.body,legs:a.state.legs,greatestHeight:a.state.greatestHeight})},a.state={head:{dataURL:null,height:null,width:null},body:{dataURL:null,height:null,width:null},legs:{dataURL:null,height:null,width:null},greatestHeight:null},a}return Object(m.a)(t,e),Object(s.a)(t,[{key:"getBodyPart",value:function(){return{dataURL:this.cropperInstance.getCroppedCanvas().toDataURL(),height:this.cropperInstance.getData().height,width:this.cropperInstance.getData().width}}},{key:"getNewGreatestHeight",value:function(e,t){return e>t?e:t}},{key:"render",value:function(){var e="";return e=null===this.state.head.dataURL?"Select head":null===this.state.body.dataURL?"Select body":null===this.state.legs.dataURL?"Select legs":"Done",i.a.createElement(R,null,i.a.createElement("div",{className:"imageContainer"},i.a.createElement(y.a,{id:"cancelCameraButton",className:"cancelButton",onClick:this.props.cancelCropping,variant:"contained"},i.a.createElement(w.a,null)),i.a.createElement("div",{id:"cropPictureButtonContainer",className:"actionButtonContainer"},i.a.createElement(g.a,{onClick:this.handleButtonClick,variant:"contained",color:"primary",className:"actionButton"},e)),i.a.createElement(x.a,{className:"imageView",ref:"cropper",src:this.props.imageDataURL,viewMode:1,dragMode:"move",ready:this._cropperReady,movable:!1,scalable:!1,zoomable:!1})))}}]),t}(n.Component),R=h.a.div.attrs({id:"StyledEditor"})(O()),j=I,N=a(39);function D(){var e=Object(c.a)(["\n  #fabricCanvas {\n    /* Is overrided */\n    width: 0px;\n    height: 0px;\n  }\n\n  #stitchPictureButtonContainer {\n    pointer-events: none;\n  }\n\n  #stitchPictureButtonContainer button {\n    pointer-events: all;\n  }\n"]);return D=function(){return e},e}var L=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(d.a)(this,Object(u.a)(t).call(this))).handleButtonClick=function(){var e=a.getMinimumBoundingRect(a.canvas.getObjects());a.saveAsPNG(a.canvas,e)},a.getMinimumBoundingRect=function(e){for(var t=null,a=null,n=0;n<e.length;n++){var i=e[n].getBoundingRect();null===t?t=new N.fabric.Point(i.left,i.top):(t.x>i.left&&(t.x=i.left),t.y>i.top&&(t.y=i.top)),null===a?a=new N.fabric.Point(i.left+i.width,i.top+i.height):(a.x<i.left+i.width&&(a.x=i.left+i.width),a.y<i.top+i.height&&(a.y=i.top+i.height))}return{topLeft:t,bottomRight:a}},a.saveAsPNG=function(e,t){var n=e.toDataURL({multiplier:1,left:t.topLeft.x,top:t.topLeft.y,width:t.bottomRight.x-t.topLeft.x,height:t.bottomRight.y-t.topLeft.y});a.props.finishedStitching(n)},a}return Object(m.a)(t,e),Object(s.a)(t,[{key:"componentDidMount",value:function(){var e=Math.max(document.documentElement.clientHeight,window.innerHeight||0),t=Math.max(document.documentElement.clientWidth,window.innerWidth||0),a=new window.fabric.Canvas("fabricCanvas",{allowTouchScrolling:!0,interactive:!0,height:e,width:t}),n={hasRotatingPoint:!1,lockSkewingX:!0,lockSkewingY:!0},i=.4*e/this.props.bodyParts.greatestHeight,o=Math.min(i,1);console.log("browserWindowHeight: "+e,"greatestHeight"+this.props.bodyParts.greatestHeight),console.log("Set scale to: "+o),N.fabric.Image.fromURL(this.props.bodyParts.head.dataURL,function(e){e.scale(o).set({top:0}),a.add(e)},n),N.fabric.Image.fromURL(this.props.bodyParts.body.dataURL,function(e){e.scale(o).set({top:200}),a.add(e)},n),N.fabric.Image.fromURL(this.props.bodyParts.legs.dataURL,function(e){e.scale(o).set({top:400}),a.add(e)},n),this.canvas=a}},{key:"render",value:function(){return i.a.createElement(U,null,i.a.createElement(E.a,{title:"Back to selecting body parts"},i.a.createElement(y.a,{id:"cancelStitcherButton",className:"cancelButton",onClick:this.props.cancelStitcher,variant:"contained"},i.a.createElement(w.a,null))),i.a.createElement("canvas",{id:"fabricCanvas"}),i.a.createElement("div",{id:"stitchPictureButtonContainer",className:"actionButtonContainer"},i.a.createElement(g.a,{onClick:this.handleButtonClick,variant:"contained",color:"primary",className:"actionButton"},"Finished stitching")))}}]),t}(n.Component),U=h.a.div.attrs({id:"StyledStitcher"})(D()),H=L,M=a(75),A=a(69),V=a.n(A),W=a(160),T=a(164);function F(){var e=Object(c.a)(["\n  .imageOptionButton {\n    position: absolute;\n    right: 0;\n  }\n"]);return F=function(){return e},e}var G=function(e){var t=i.a.useState(null),a=Object(M.a)(t,2),n=a[0],o=a[1];function r(){o(null)}return i.a.createElement(z,null,i.a.createElement(y.a,{"aria-label":"Options","aria-controls":"image-menu","aria-haspopup":"true",onClick:function(e){o(e.currentTarget)},size:"small",className:"imageOptionButton"},i.a.createElement(V.a,null)),i.a.createElement(W.a,{id:"image-menu",anchorEl:n,keepMounted:!0,open:Boolean(n),onClose:r},i.a.createElement(T.a,{onClick:r},"Save"),i.a.createElement(T.a,{onClick:function(){var t=n.parentNode.parentNode.id+"";o(null),e.handleDeleteImg(t)}},"Delete")))},z=h.a.div.attrs({id:"StyledImageMenu"})(F());var q=function(e){function t(t){e.handleDeleteImage(t)}var a=e.images.map(function(a){var n=null;return"stitched"===e.type?n=i.a.createElement("img",{src:a[1].stitchedImageDataURL,alt:"stitched"}):"original"===e.type&&(n=i.a.createElement("img",{src:a[1].originalImageDataURL,alt:"stitched"})),i.a.createElement("div",{className:"imageBox",key:a[0],id:a[0]},i.a.createElement(G,{handleDeleteImg:t}),n)});return i.a.createElement(i.a.Fragment,null,a)};function Y(){var e=Object(c.a)(["\n  #imageBoxContainer {\n    display: flex;\n    flex-wrap: wrap;\n    flex-direction: row;\n    justify-content: center;\n  }\n\n  .imageBox {\n    width: 10rem;\n    height: 10rem;\n    margin: 0.5em;\n    position: relative;\n  }\n\n  .imageBox img {\n    width: 100%;\n    height: 100%;\n    object-fit: scale-down;\n    border: 1px solid grey;\n  }\n"]);return Y=function(){return e},e}var J=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return(a=Object(d.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(i)))).handleDeleteImage=function(e){v.a.removeItem(e,function(){var t=a.state.images.filter(function(t){return t[0]!==e});a.setState({images:t},function(){a.storeNumImgs(t.length)})}).catch(function(e){console.log(e)})},a.storeNumImgs=function(e){a.state&&a.props.setNumOriginalsInDatabase&&a.props.setNumOriginalsInDatabase(e)},a}return Object(m.a)(t,e),Object(s.a)(t,[{key:"componentDidMount",value:function(){var e=this,t=[];v.a.iterate(function(a,n,i){"stitched"===e.props.type&&null!=a.stitchedImageDataURL?t.push([n,a]):"original"===e.props.type&&null!=a.originalImageDataURL&&t.push([n,a])}).then(function(){t.length>0&&e.setState({images:t},function(){e.storeNumImgs(t.length)})}).catch(function(e){console.log(e)})}},{key:"render",value:function(){return i.a.createElement(_,null,i.a.createElement("h3",null,this.props.title),null!==this.state?i.a.createElement("div",{id:"imageBoxContainer"},i.a.createElement(q,{images:this.state.images,type:this.props.type,handleDeleteImage:this.handleDeleteImage})):i.a.createElement("p",null,"No images found"))}}]),t}(n.Component),_=h.a.div.attrs({id:"StyledAlbum"})(Y()),X=J,$=a(56),K=a.n($),Q=a(72),Z=a(73),ee=a.n(Z),te=a(74),ae=a.n(te),ne=a(52),ie=a.n(ne);a(129),a(131);function oe(){var e=Object(c.a)(["\n  .slick-slide {\n    filter: saturate(50%);\n  }\n\n  .slick-center {\n    filter: saturate(100%);\n    transition: all 0.3s ease;\n    transform: scale(1.25);\n  }\n\n  .sliderContainer {\n    max-width: 500px;\n    /* Padding to allow for next and previous buttons */\n    padding-left: calc(1em + 25px);\n    padding-right: calc(1em + 25px);\n    margin-right: auto;\n    margin-left: auto;\n  }\n\n  .slick-prev:hover,\n  .slick-prev:focus,\n  .slick-next:hover,\n  .slick-next:focus {\n    color: black;\n  }\n\n  #headSliderContainer {\n  }\n\n  #bodySliderContainer {\n    margin-top: 1em;\n  }\n\n  #legsSliderContainer {\n    margin-top: 1em;\n  }\n\n  #selectBodyPartsButton {\n    margin-top: 2.5em;\n  }\n\n  .imageBox {\n  }\n\n  .imageBox img {\n    width: calc(100% - 2em);\n    margin: 1em;\n    /* Extra top margin to allow image to grow */\n    margin-top: 2em;\n  }\n\n  h4 {\n    margin-top: 2em;\n  }\n"]);return oe=function(){return e},e}var re=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return(a=Object(d.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(i)))).handleSelectBodyParts=Object(Q.a)(K.a.mark(function e(){var t,n,i,o,r,c,l,s,d,u,m;return K.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=document.querySelector("#headSliderContainer .slick-center .imageBox").id,n=document.querySelector("#bodySliderContainer .slick-center .imageBox").id,i=document.querySelector("#legsSliderContainer .slick-center .imageBox").id,e.next=5,v.a.getItem(t).catch(function(e){console.log(e)});case 5:return o=e.sent,e.next=8,v.a.getItem(n).catch(function(e){console.log(e)});case 8:return r=e.sent,e.next=11,v.a.getItem(i).catch(function(e){console.log(e)});case 11:c=e.sent,l=o.bodyParts.head,s=r.bodyParts.body,d=c.bodyParts.legs,u=Math.max(l.height,s.height,d.height),m={head:l,body:s,legs:d,greatestHeight:u},a.props.finishedSelecting(m);case 18:case"end":return e.stop()}},e)})),a}return Object(m.a)(t,e),Object(s.a)(t,[{key:"componentDidMount",value:function(){var e=this,t=[];v.a.iterate(function(e,a,n){null!=e.originalImageDataURL&&t.push([a,e])}).then(function(){t.length>0&&e.setState({images:t})}).catch(function(e){console.log(e)})}},{key:"render",value:function(){var e=3;null!==this.state&&this.state.images.length<=e&&(e=1);var t={dots:!0,arrows:!0,infinite:!0,speed:300,slidesToShow:e,centerMode:!0,swipeToSlide:!0,focusOnSelect:!0,nextArrow:i.a.createElement(ee.a,{color:"action",fontSize:"large"}),prevArrow:i.a.createElement(ae.a,{color:"action",fontSize:"large"}),responsive:[{breakpoint:415,settings:{slidesToShow:1}}]};return i.a.createElement(ce,null,i.a.createElement(E.a,{title:"Back to front page"},i.a.createElement(y.a,{className:"cancelButton",onClick:this.props.cancelBodyPartSelector,variant:"contained"},i.a.createElement(w.a,null))),i.a.createElement("h4",null,"Select which body parts you want to mix"),i.a.createElement("div",{id:"headSliderContainer",className:"sliderContainer"},null!==this.state?i.a.createElement(ie.a,Object.assign({},t,{afterChange:this.afterChangeHead}),this.state.images.map(function(e){return i.a.createElement("div",{className:"imageBox",key:e[0],id:e[0]},i.a.createElement("img",{src:e[1].bodyParts.head.dataURL,alt:"stitched"}))})):i.a.createElement("p",null,"No images found")),i.a.createElement("div",{id:"bodySliderContainer",className:"sliderContainer"},null!==this.state?i.a.createElement(ie.a,t,this.state.images.map(function(e){return i.a.createElement("div",{className:"imageBox",key:e[0],id:e[0]},i.a.createElement("img",{src:e[1].bodyParts.body.dataURL,alt:"stitched"}))})):i.a.createElement("p",null,"No images found")),i.a.createElement("div",{id:"legsSliderContainer",className:"sliderContainer"},null!==this.state?i.a.createElement(ie.a,t,this.state.images.map(function(e){return i.a.createElement("div",{className:"imageBox",key:e[0],id:e[0]},i.a.createElement("img",{src:e[1].bodyParts.legs.dataURL,alt:"stitched"}))})):i.a.createElement("p",null,"No images found")),i.a.createElement(E.a,{title:"Use the selected body parts"},i.a.createElement(g.a,{onClick:this.handleSelectBodyParts,id:"selectBodyPartsButton",variant:"contained",color:"primary"},"Continue")))}}]),t}(n.Component),ce=h.a.div.attrs({id:"StyledBodyPartSelector"})(oe());function le(){var e=Object(c.a)(["\n  .App {\n    text-align: center;\n  }\n\n  .AppButtons {\n    margin-bottom: 2em;\n  }\n\n  .imageContainer {\n    height: 100vh;\n    width: 100vw;\n    display: flex;\n  }\n\n  .imageView {\n    object-fit: contain;\n    flex-grow: 1;\n    max-width: 100%;\n    max-height: 100%;\n  }\n\n  .cancelButton {\n    position: fixed;\n    top: 0;\n    left: 0;\n    z-index: 1;\n    margin: 0.3em;\n  }\n\n  .actionButton {\n    margin-bottom: 2em;\n  }\n\n  .actionButtonContainer {\n    position: fixed;\n    bottom: 0;\n    width: 100%;\n    text-align: center;\n  }\n"]);return le=function(){return e},e}var se=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(d.a)(this,Object(u.a)(t).call(this,e))).handleStartCameraButtonClick=function(){a.showCamera()},a.handleConnectBodyPartsButtonClick=function(){a.showBodyPartSelector()},a.showFrontPage=function(){a.setState({view:"app"})},a.showCamera=function(){a.setState({view:"camera"})},a.showCropper=function(){a.setState({view:"cropper"})},a.showStitcher=function(e){a.setState({bodyParts:e,view:"stitcher"})},a.showBodyPartSelector=function(){a.setState({view:"bodyPartSelector"})},a.storeOriginalPicture=function(e){a.setState({originalImageDataURL:e},function(){a.setState({view:"cropper"})})},a.storeStitchedPicture=function(e){v.a.setItem(Date.now()+"",{stitchedImageDataURL:e}).then(function(){a.setState({view:"app"})}).catch(function(e){console.log(e)})},a.storeBodyParts=function(e){a.setState({bodyParts:e},function(){v.a.setItem(Date.now()+"",{originalImageDataURL:a.state.originalImageDataURL,bodyParts:a.state.bodyParts}).then(function(){a.setState({view:"app"})}).catch(function(e){console.log(e)})})},a.setNumOriginalsInDatabase=function(e){a.setState({numOriginalsInDatabase:e})},a.state={view:"app",numOriginalsInDatabase:null,originalImageDataURL:null,stitchedImageDataURL:null,bodyParts:{head:{dataURL:null,height:null,width:null},body:{dataURL:null,height:null,width:null},legs:{dataURL:null,height:null,width:null},greatestHeight:null}},a}return Object(m.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){var e,t=null;return t=this.state.numOriginalsInDatabase>1?i.a.createElement(g.a,{onClick:this.handleConnectBodyPartsButtonClick,id:"connectBodypartsButton",className:"AppButtons",variant:"contained",color:"primary"},"Connect bodyparts!"):i.a.createElement("p",null,"You need to take two pictures before partying"),"app"===this.state.view?e=i.a.createElement(n.Fragment,null,i.a.createElement("h1",null,"Mix Max"),i.a.createElement(g.a,{onClick:this.handleStartCameraButtonClick,id:"startCameraButton",className:"AppButtons",variant:"contained",color:"primary"},"Start camera"),i.a.createElement("br",null),t,i.a.createElement(p.a,{variant:"middle"}),i.a.createElement(X,{title:"Your exquisite corpse bodies",type:"stitched"}),i.a.createElement(X,{title:"Your original photos",type:"original",setNumOriginalsInDatabase:this.setNumOriginalsInDatabase})):"camera"===this.state.view?e=i.a.createElement(k,{className:"yolo",cancelCamera:this.showFrontPage,finishedTakingPicture:this.storeOriginalPicture}):"cropper"===this.state.view?e=i.a.createElement(j,{imageDataURL:this.state.originalImageDataURL,cancelCropping:this.showCamera,finishedCropping:this.storeBodyParts}):"stitcher"===this.state.view?e=i.a.createElement(H,{bodyParts:this.state.bodyParts,finishedStitching:this.storeStitchedPicture,cancelStitcher:this.showBodyPartSelector}):"bodyPartSelector"===this.state.view&&(e=i.a.createElement(re,{cancelBodyPartSelector:this.showFrontPage,finishedSelecting:this.showStitcher})),i.a.createElement(de,null,i.a.createElement("div",{className:"App"},e))}}]),t}(n.Component),de=h.a.div.attrs({id:"StyledApp"})(le()),ue=se;Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(i.a.createElement(ue,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},80:function(e,t,a){e.exports=a(133)},85:function(e,t,a){}},[[80,2,1]]]);
//# sourceMappingURL=main.2de1e80b.chunk.js.map